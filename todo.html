<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Application TO-DO List</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap">
  <!-- Inclusion de Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* Styles globaux */
    * { box-sizing: border-box; }
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f7f7f8;
      color: #333;
    }
    header {
      text-align: center;
      padding: 1rem;
      border-bottom: 1px solid #e0e0e0;
      background-color: #fff;
    }
    header h1 {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 600;
    }
    section {
      text-align: center;
      margin: 1rem;
    }
    #newTask {
      width: 60%;
      max-width: 400px;
      padding: 0.5rem;
      font-size: 1rem;
      border: 1px solid #ddd;
      border-radius: 8px;
      outline: none;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    #newTask:focus {
      border-color: #007aff;
      box-shadow: 0 0 5px rgba(0,122,255,0.2);
    }
    button, label.button {
      padding: 0.5rem 1rem;
      font-size: 1rem;
      margin: 0.5rem;
      background-color: #007aff;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.2s ease;
      text-decoration: none;
    }
    button:hover, label.button:hover {
      background-color: #005bb5;
    }
    input[type="file"] {
      display: none;
    }
    /* Section du graphique */
    #chartContainer {
      width: 90%;
      max-width: 600px;
      margin: 0 auto 1rem;
      padding: 1rem;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    main {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1rem;
      padding: 1rem;
    }
    .column {
      background-color: #fff;
      border-radius: 8px;
      width: 250px;
      min-height: 300px;
      padding: 1rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
    }
    .column h2 {
      text-align: center;
      margin-top: 0;
      margin-bottom: 1rem;
      font-size: 1.2rem;
      font-weight: 600;
    }
    ul {
      list-style-type: none;
      padding: 0;
      flex-grow: 1;
    }
    li {
      background-color: #f1f1f1;
      margin: 0.5rem 0;
      padding: 0.75rem;
      border-radius: 6px;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.2s ease;
    }
    li:hover {
      background-color: #e0e0e0;
    }
    .drag-over {
      border: 2px dashed #007aff;
    }
  </style>
</head>
<body>
  <header>
    <h1>Application TO-DO List</h1>
  </header>
  <section>
    <input type="text" id="newTask" placeholder="Ajouter une tâche...">
    <button id="addTaskBtn">Ajouter</button>
    <button id="saveBtn">Sauvegarder</button>
    <label for="importFile" class="button">Importer</label>
    <input type="file" id="importFile" accept=".json">
  </section>
  <section id="chartContainer">
    <canvas id="taskChart"></canvas>
  </section>
  <main>
    <div class="column" data-status="A faire">
      <h2>A faire</h2>
      <ul id="todoList"></ul>
    </div>
    <div class="column" data-status="En cours">
      <h2>En cours</h2>
      <ul id="inProgressList"></ul>
    </div>
    <div class="column" data-status="Fini">
      <h2>Fini</h2>
      <ul id="finishedList"></ul>
    </div>
    <div class="column" data-status="Non clôturé">
      <h2>Non clôturé</h2>
      <ul id="nonClosedList"></ul>
    </div>
    <div class="column" data-status="Cloturé">
      <h2>Cloturé</h2>
      <ul id="closedList"></ul>
    </div>
  </main>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const addTaskBtn = document.getElementById('addTaskBtn');
      const newTaskInput = document.getElementById('newTask');
      const saveBtn = document.getElementById('saveBtn');
      const importFileInput = document.getElementById('importFile');

      // Configuration du graphique
      const ctx = document.getElementById('taskChart').getContext('2d');
      const chartLabels = ["A faire", "En cours", "Fini", "Non clôturé", "Cloturé"];
      const taskChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: chartLabels,
          datasets: [{
            label: 'Nombre de tâches',
            data: [0, 0, 0, 0, 0],
            backgroundColor: chartLabels.map(() => '#007aff')
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              ticks: { precision: 0 }
            }
          }
        }
      });

      function updateChart() {
        const counts = chartLabels.map(status => {
          const listElement = getListElement(status);
          return listElement ? listElement.querySelectorAll('li').length : 0;
        });
        taskChart.data.datasets[0].data = counts;
        taskChart.update();
      }

      addTaskBtn.addEventListener('click', function() {
        const taskText = newTaskInput.value.trim();
        if (taskText !== '') {
          createTask(taskText, "A faire"); // Ajoute par défaut dans "A faire"
          newTaskInput.value = '';
          updateChart();
        }
      });

      newTaskInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          addTaskBtn.click();
        }
      });

      function createTask(text, status) {
        const li = document.createElement('li');
        li.textContent = text;
        li.setAttribute('draggable', true);
        li.addEventListener('dragstart', dragStart);
        li.addEventListener('dragend', dragEnd);
        const listElement = getListElement(status);
        if (listElement) {
          listElement.appendChild(li);
        }
        updateChart();
      }

      function getListElement(status) {
        switch(status) {
          case "A faire": return document.getElementById('todoList');
          case "En cours": return document.getElementById('inProgressList');
          case "Fini": return document.getElementById('finishedList');
          case "Non clôturé": return document.getElementById('nonClosedList');
          case "Cloturé": return document.getElementById('closedList');
          default: return null;
        }
      }

      let draggedItem = null;

      function dragStart(e) {
        draggedItem = this;
        setTimeout(() => { this.style.display = 'none'; }, 0);
      }

      function dragEnd(e) {
        this.style.display = 'block';
        draggedItem = null;
        updateChart();
      }

      const columns = document.querySelectorAll('.column ul');
      columns.forEach(ul => {
        ul.addEventListener('dragover', function(e) {
          e.preventDefault();
          this.classList.add('drag-over');
        });
        ul.addEventListener('dragleave', function(e) {
          this.classList.remove('drag-over');
        });
        ul.addEventListener('drop', function(e) {
          e.preventDefault();
          this.classList.remove('drag-over');
          if (draggedItem) {
            this.appendChild(draggedItem);
          }
          updateChart();
        });
      });

      // Sauvegarder les tâches dans un fichier JSON
      saveBtn.addEventListener('click', function() {
        const tasks = [];
        document.querySelectorAll('.column').forEach(column => {
          const status = column.getAttribute('data-status');
          column.querySelectorAll('li').forEach(li => {
            tasks.push({ text: li.textContent, status: status });
          });
        });
        const dataStr = JSON.stringify({ tasks: tasks }, null, 2);
        const blob = new Blob([dataStr], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = "tasks.json";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      });

      // Importer les tâches depuis un fichier JSON
      importFileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const data = JSON.parse(e.target.result);
            if (data.tasks && Array.isArray(data.tasks)) {
              document.querySelectorAll('ul').forEach(ul => ul.innerHTML = '');
              data.tasks.forEach(task => {
                createTask(task.text, task.status);
              });
              updateChart();
            }
          } catch (err) {
            alert("Erreur lors de l'importation du fichier.");
          }
        };
        reader.readAsText(file);
        importFileInput.value = "";
      });
    });
  </script>
</body>
</html>
